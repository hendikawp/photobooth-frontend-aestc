import{d as E,J as f,h as B,c as G,l as z,ac as F,o as N,b as i,G as o,s as p,F as P,B as L,E as h,q as v,p as x,Q as V,T as I,v as y,e as l,L as Q,k as U,ad as k}from"./index-BQ1gfdb-.js";import{_ as H,a as J}from"./PreviewStream.vue_vue_type_style_index_0_lang-CCUY5QWM.js";import{_ as M}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./QCircularProgress-DEx_ZwD9.js";import"./format-CJebrXOQ.js";const O={class:"fullscreen bg-primary text-white text-center row flex-center",style:{"padding-left":"32px","padding-right":"32px","padding-top":"16px","padding-bottom":"16px"}},R={class:"frame-list q-mt-md"},D=["onClick"],K=["src","alt"],W={key:0,class:"q-mt-md text-center"},X=["src","alt"],Y={key:0,class:"fullscreen column justify-center items-center preview-overlay"},Z={id:"frontpage-countdown",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",display:"flex","flex-direction":"column","align-items":"center",gap:"16px",padding:"32px","background-color":"rgba(0, 0, 0, 0.6)","border-radius":"12px"}},ee={key:1,class:"fullscreen column justify-center items-center lets-go-overlay"},te=E({__name:"TemplateSelect",setup(ae){const r=f(null),u=f(!1),m=f(!1),b=U();let g=null,_=null;function T(t){r.value=t}const c=B(),n=f(c.configuration);function A(t){return n.value.actions&&Array.isArray(n.value.actions.collage)&&n.value.actions.collage[0]&&n.value.actions.collage[0].processing?(n.value.actions.collage[0].processing.canvas_img_front_file=t,c.configuration=n.value,console.log("Frame updated to:",t),console.log("Updated config:",n.value.actions.collage[0].processing),k.create({message:"Canvas image front file updated!",color:"positive"}),!0):(k.create({message:"Structure not found or invalid!",color:"negative"}),!1)}async function C(){if(!r.value){alert("Silakan pilih frame terlebih dahulu.");return}const t=await A(r.value.name);t&&t&&(u.value=!0,g=setTimeout(()=>{u.value=!1,m.value=!0,_=setTimeout(async()=>{m.value=!1,await S("actions/collage",0)},2e3)},15e3))}const $=G(()=>c.configuration.uisettings?.livestream_frameoverlay_image||"");async function S(t,e){const a=`/api/${t}/${e}`;try{const s=await fetch(a,{method:"GET",headers:{Accept:"application/json"}});if(!s.ok){const j=await s.text();throw new Error(`Gagal menjalankan aksi. Status: ${s.status} - ${j}`)}const d=await s.json().catch(()=>({}));console.log("Aksi berhasil:",d),d&&d.redirect_url?window.location.href=d.redirect_url:b.push({name:"indexPage"})}catch(s){console.error("invokeAction error:",s)}}const w=f([]);z(async()=>{await q()});async function q(){try{const t=F();if(!t)throw new Error("No access token available");const e=await fetch("/api/admin/files/list/userdata/frame",{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const a=await e.json();w.value=Array.isArray(a)?a:[]}catch(t){console.error("Error load frames:",t)}}return N(()=>{g&&clearTimeout(g),_&&clearTimeout(_)}),(t,e)=>(l(),i("div",O,[o("div",{class:h(["col-9 scroll-area q-pr-md",{"hidden-on-preview":u.value||m.value}])},[e[0]||(e[0]=o("h2",{class:"text-center"},"Pilih Template Frame",-1)),o("div",R,[(l(!0),i(P,null,L(w.value,(a,s)=>(l(),i("div",{key:s,class:h(["frame-item",{selected:a.name===r.value?.name}]),onClick:d=>T(a)},[o("img",{src:`/userdata/frame/${a.name}`,alt:a.name,width:"150",height:"auto",loading:"lazy"},null,8,K)],10,D))),128))])],2),o("div",{class:h(["col-3 q-pl-md sticky-frame",{"hidden-on-preview":u.value||m.value}]),style:{position:"sticky",top:"80px"}},[e[2]||(e[2]=o("h3",{class:"text-center"},"Preview Pilihan",-1)),r.value?(l(),i("div",W,[v(V,{unelevated:"",rounded:"",color:"white","text-color":"primary",class:"q-mt-xl q-px-xl q-py-md",size:"xl",onClick:C},{default:x(()=>e[1]||(e[1]=[Q(" Lanjut ")])),_:1,__:[1]})])):p("",!0),v(I,{name:"fade-zoom"},{default:x(()=>[r.value?(l(),i("img",{key:0,src:`/userdata/frame/${r.value.name}`,alt:r.value.name,class:"q-mt-lg selected-preview"},null,8,X)):p("",!0)]),_:1})],2),u.value?(l(),i("div",Y,[v(H,{"frame-overlay-image":$.value,"enable-blurred-background-stream":y(c).configuration.uisettings.livestream_blurredbackground,"enable-mirror-effect-stream":y(c).configuration.uisettings.livestream_mirror_effect,"enable-mirror-effect-frame":y(c).configuration.uisettings.livestream_frameoverlay_mirror_effect},null,8,["frame-overlay-image","enable-blurred-background-stream","enable-mirror-effect-stream","enable-mirror-effect-frame"]),o("div",Z,[e[3]||(e[3]=o("h2",{class:"preview-title",style:{color:"white","text-shadow":"1px 1px 4px rgba(0, 0, 0, 0.5)",margin:"0"}},"Sesi Anda akan dimulai dalam",-1)),v(J,{ref:"countdowntimer",duration:15,"number-color":"limegreen","number-font-size":"4rem","number-font-weight":"bold"},null,512)])])):p("",!0),m.value?(l(),i("div",ee,e[4]||(e[4]=[o("h1",{class:"lets-go-text"},"Let's Go!",-1)]))):p("",!0)]))}}),le=M(te,[["__scopeId","data-v-37922fee"]]);export{le as default};
